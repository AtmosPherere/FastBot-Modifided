# Fastbot 重用模型测试脚本使用说明

## 概述

本项目提供了两个测试脚本来验证 Fastbot 重用模型的效果：

1. **`run_reuse_test.sh`** - 完整的60分钟×2轮测试脚本
2. **`quick_reuse_test.sh`** - 快速的5分钟×2轮验证脚本

## 脚本功能

### 1. run_reuse_test.sh（完整测试）

**功能：** 进行两轮60分钟的完整测试，详细分析重用效果

**测试流程：**
1. **第1轮**：冷启动测试，清理旧模型，从零开始探索
2. **第2轮**：重用第1轮生成的模型进行测试
3. **分析**：详细比较两轮的活动覆盖率、重复探索情况

**生成的分析文件：**
- `round1_test.log` - 第1轮完整测试日志
- `round2_test.log` - 第2轮完整测试日志
- `round1_coverage.txt` - 第1轮探索的活动列表
- `round2_coverage.txt` - 第2轮探索的活动列表
- `coverage_comparison.txt` - 详细的覆盖率比较分析
- `model_analysis.txt` - 模型文件变化分析
- `test_report.md` - 完整的测试报告
- `final_model.fbm` - 最终模型文件备份

### 2. quick_reuse_test.sh（快速验证）

**功能：** 进行两轮5分钟的快速测试，验证基本功能

**测试流程：**
1. **第1轮**：5分钟冷启动测试
2. **第2轮**：5分钟重用模型测试
3. **快速比较**：基本的活动数量对比和关键日志检查

**生成的文件：**
- `round1_test.log` - 第1轮测试日志
- `round2_test.log` - 第2轮测试日志

## 使用方法

### 准备工作

1. **确保设备连接**：
   ```bash
   adb devices
   ```

2. **确保应用已安装**：
   ```bash
   adb shell pm list packages | grep com.netease.cloudmusic
   ```

3. **确保 Fastbot 文件已部署**：
   - 运行 `./build_and_deploy.sh` 或 `./quick_deploy.sh`

### 运行完整测试（推荐）

```bash
./run_reuse_test.sh
```

**预计耗时：** 约2小时（2×60分钟测试 + 分析时间）

### 运行快速验证

```bash
./quick_reuse_test.sh
```

**预计耗时：** 约10-15分钟（2×5分钟测试 + 分析时间）

## 关键指标分析

### 1. 活动覆盖率提升

- **第1轮活动数**：冷启动探索的不同活动数量
- **第2轮活动数**：重用模型后探索的不同活动数量
- **提升率**：`(第2轮 - 第1轮) / 第1轮 × 100%`

### 2. 重复探索分析

- **重复活动数**：两轮都探索的活动数量
- **重复率**：`重复活动数 / 第1轮活动数 × 100%`
- **新增活动数**：第2轮新探索的活动数量

### 3. 重用模型效果验证

脚本会检查以下关键日志来验证重用模型是否正常工作：

- ✅ `"select action in reuse model"` - 表示成功从重用模型中选择了操作
- ✅ `"save widget reuse model"` - 表示模型保存功能正常
- ✅ 模型文件存在且大小合理

## 预期结果

### 成功的重用模型应该表现为：

1. **第2轮活动覆盖率 ≥ 第1轮**：重用模型帮助更高效地探索
2. **存在重复探索**：说明模型记录了有效的探索路径
3. **存在新活动探索**：说明模型帮助发现了新的探索路径
4. **关键日志存在**：确认重用机制正常工作

### 示例输出：

```
========================================
活动覆盖率比较分析
========================================

第1轮测试探索活动数: 25
第2轮测试探索活动数: 32

两轮都探索的活动数: 20
仅第1轮探索的活动数: 5
仅第2轮探索的活动数: 12

活动重复率: 80.00%
覆盖率提升: 28.00%
```

## 故障排除

### 常见问题

1. **"未检测到 Android 设备"**
   - 检查 USB 连接和调试权限
   - 运行 `adb devices` 确认设备状态

2. **"应用未安装"**
   - 安装网易云音乐应用
   - 或修改脚本中的 `PACKAGE_NAME` 变量

3. **"测试失败"**
   - 检查应用是否可以正常启动
   - 查看生成的日志文件了解详细错误

4. **"未生成模型文件"**
   - 检查存储权限
   - 确认测试时间足够长（至少5分钟）

### 调试模式

如需查看详细执行过程：

```bash
bash -x ./run_reuse_test.sh
```

## 自定义配置

可以修改脚本开头的配置参数：

```bash
PACKAGE_NAME="com.netease.cloudmusic"  # 目标应用包名
TEST_DURATION=60                       # 每轮测试时长（分钟）
THROTTLE=600                          # 操作间隔（毫秒）
```

## 结果解读

### 良好的重用效果指标：

- **覆盖率提升** > 10%
- **重复率** 在 60-90% 之间（太低说明模型无效，太高说明探索不够）
- **新活动发现** > 0（说明模型帮助发现新路径）
- **关键日志完整**（确认功能正常）

### 需要关注的情况：

- 第2轮活动数显著少于第1轮
- 重复率过低（<50%）或过高（>95%）
- 缺少关键的重用模型日志
- 模型文件未生成或异常小

---

**注意：** 测试过程中请保持设备屏幕常亮，避免锁屏影响测试结果。
